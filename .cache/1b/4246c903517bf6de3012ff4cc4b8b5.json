{"id":"../../node_modules/phaser/src/sound/webaudio/WebAudioSoundManager.js","dependencies":[{"name":"C:\\Users\\דור\\Desktop\\pmm\\package.json","includedInParent":true,"mtime":1560952935180},{"name":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\package.json","includedInParent":true,"mtime":1561396619369},{"name":"../BaseSoundManager","loc":{"line":8,"column":31},"parent":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\webaudio\\WebAudioSoundManager.js","resolved":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\BaseSoundManager.js"},{"name":"../../utils/Class","loc":{"line":9,"column":20},"parent":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\webaudio\\WebAudioSoundManager.js","resolved":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\utils\\Class.js"},{"name":"../events","loc":{"line":10,"column":21},"parent":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\webaudio\\WebAudioSoundManager.js","resolved":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\events\\index.js"},{"name":"./WebAudioSound","loc":{"line":11,"column":28},"parent":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\webaudio\\WebAudioSoundManager.js","resolved":"C:\\Users\\דור\\Desktop\\pmm\\node_modules\\phaser\\src\\sound\\webaudio\\WebAudioSound.js"}],"generated":{"js":"/**\r\n * @author       Richard Davey <rich@photonstorm.com>\r\n * @author       Pavle Goloskokovic <pgoloskokovic@gmail.com> (http://prunegames.com)\r\n * @copyright    2019 Photon Storm Ltd.\r\n * @license      {@link https://opensource.org/licenses/MIT|MIT License}\r\n */\r\n\r\nvar BaseSoundManager = require('../BaseSoundManager');\r\nvar Class = require('../../utils/Class');\r\nvar Events = require('../events');\r\nvar WebAudioSound = require('./WebAudioSound');\r\n\r\n/**\r\n * @classdesc\r\n * Web Audio API implementation of the sound manager.\r\n *\r\n * @class WebAudioSoundManager\r\n * @extends Phaser.Sound.BaseSoundManager\r\n * @memberof Phaser.Sound\r\n * @constructor\r\n * @since 3.0.0\r\n *\r\n * @param {Phaser.Game} game - Reference to the current game instance.\r\n */\r\nvar WebAudioSoundManager = new Class({\r\n\r\n    Extends: BaseSoundManager,\r\n\r\n    initialize:\r\n\r\n    function WebAudioSoundManager (game)\r\n    {\r\n        /**\r\n         * The AudioContext being used for playback.\r\n         *\r\n         * @name Phaser.Sound.WebAudioSoundManager#context\r\n         * @type {AudioContext}\r\n         * @private\r\n         * @since 3.0.0\r\n         */\r\n        this.context = this.createAudioContext(game);\r\n\r\n        /**\r\n         * Gain node responsible for controlling global muting.\r\n         *\r\n         * @name Phaser.Sound.WebAudioSoundManager#masterMuteNode\r\n         * @type {GainNode}\r\n         * @private\r\n         * @since 3.0.0\r\n         */\r\n        this.masterMuteNode = this.context.createGain();\r\n\r\n        /**\r\n         * Gain node responsible for controlling global volume.\r\n         *\r\n         * @name Phaser.Sound.WebAudioSoundManager#masterVolumeNode\r\n         * @type {GainNode}\r\n         * @private\r\n         * @since 3.0.0\r\n         */\r\n        this.masterVolumeNode = this.context.createGain();\r\n\r\n        this.masterMuteNode.connect(this.masterVolumeNode);\r\n\r\n        this.masterVolumeNode.connect(this.context.destination);\r\n\r\n        /**\r\n         * Destination node for connecting individual sounds to.\r\n         *\r\n         * @name Phaser.Sound.WebAudioSoundManager#destination\r\n         * @type {AudioNode}\r\n         * @private\r\n         * @since 3.0.0\r\n         */\r\n        this.destination = this.masterMuteNode;\r\n\r\n        this.locked = this.context.state === 'suspended' && ('ontouchstart' in window || 'onclick' in window);\r\n\r\n        BaseSoundManager.call(this, game);\r\n\r\n        if (this.locked)\r\n        {\r\n            this.unlock();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method responsible for instantiating and returning AudioContext instance.\r\n     * If an instance of an AudioContext class was provided through the game config,\r\n     * that instance will be returned instead. This can come in handy if you are reloading\r\n     * a Phaser game on a page that never properly refreshes (such as in an SPA project)\r\n     * and you want to reuse already instantiated AudioContext.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#createAudioContext\r\n     * @private\r\n     * @since 3.0.0\r\n     *\r\n     * @param {Phaser.Game} game - Reference to the current game instance.\r\n     *\r\n     * @return {AudioContext} The AudioContext instance to be used for playback.\r\n     */\r\n    createAudioContext: function (game)\r\n    {\r\n        var audioConfig = game.config.audio;\r\n\r\n        if (audioConfig && audioConfig.context)\r\n        {\r\n            audioConfig.context.resume();\r\n\r\n            return audioConfig.context;\r\n        }\r\n\r\n        return new AudioContext();\r\n    },\r\n\r\n    /**\r\n     * Adds a new sound into the sound manager.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#add\r\n     * @since 3.0.0\r\n     *\r\n     * @param {string} key - Asset key for the sound.\r\n     * @param {Phaser.Types.Sound.SoundConfig} [config] - An optional config object containing default sound settings.\r\n     *\r\n     * @return {Phaser.Sound.WebAudioSound} The new sound instance.\r\n     */\r\n    add: function (key, config)\r\n    {\r\n        var sound = new WebAudioSound(this, key, config);\r\n\r\n        this.sounds.push(sound);\r\n\r\n        return sound;\r\n    },\r\n\r\n    /**\r\n     * Unlocks Web Audio API on the initial input event.\r\n     *\r\n     * Read more about how this issue is handled here in [this article](https://medium.com/@pgoloskokovic/unlocking-web-audio-the-smarter-way-8858218c0e09).\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#unlock\r\n     * @since 3.0.0\r\n     */\r\n    unlock: function ()\r\n    {\r\n        var _this = this;\r\n\r\n        var unlockHandler = function unlockHandler ()\r\n        {\r\n            if (_this.context)\r\n            {\r\n                _this.context.resume().then(function ()\r\n                {\r\n                    document.body.removeEventListener('touchstart', unlockHandler);\r\n                    document.body.removeEventListener('touchend', unlockHandler);\r\n                    document.body.removeEventListener('click', unlockHandler);\r\n    \r\n                    _this.unlocked = true;\r\n                });\r\n            }\r\n        };\r\n\r\n        if (document.body)\r\n        {\r\n            document.body.addEventListener('touchstart', unlockHandler, false);\r\n            document.body.addEventListener('touchend', unlockHandler, false);\r\n            document.body.addEventListener('click', unlockHandler, false);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method used internally for pausing sound manager if\r\n     * Phaser.Sound.WebAudioSoundManager#pauseOnBlur is set to true.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#onBlur\r\n     * @protected\r\n     * @since 3.0.0\r\n     */\r\n    onBlur: function ()\r\n    {\r\n        if (!this.locked)\r\n        {\r\n            this.context.suspend();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Method used internally for resuming sound manager if\r\n     * Phaser.Sound.WebAudioSoundManager#pauseOnBlur is set to true.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#onFocus\r\n     * @protected\r\n     * @since 3.0.0\r\n     */\r\n    onFocus: function ()\r\n    {\r\n        if (!this.locked)\r\n        {\r\n            this.context.resume();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Calls Phaser.Sound.BaseSoundManager#destroy method\r\n     * and cleans up all Web Audio API related stuff.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#destroy\r\n     * @since 3.0.0\r\n     */\r\n    destroy: function ()\r\n    {\r\n        this.destination = null;\r\n        this.masterVolumeNode.disconnect();\r\n        this.masterVolumeNode = null;\r\n        this.masterMuteNode.disconnect();\r\n        this.masterMuteNode = null;\r\n\r\n        if (this.game.config.audio && this.game.config.audio.context)\r\n        {\r\n            this.context.suspend();\r\n        }\r\n        else\r\n        {\r\n            var _this = this;\r\n\r\n            this.context.close().then(function ()\r\n            {\r\n\r\n                _this.context = null;\r\n\r\n            });\r\n        }\r\n\r\n        BaseSoundManager.prototype.destroy.call(this);\r\n    },\r\n\r\n    /**\r\n     * Sets the muted state of all this Sound Manager.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#setMute\r\n     * @fires Phaser.Sound.Events#GLOBAL_MUTE\r\n     * @since 3.3.0\r\n     *\r\n     * @param {boolean} value - `true` to mute all sounds, `false` to unmute them.\r\n     *\r\n     * @return {Phaser.Sound.WebAudioSoundManager} This Sound Manager.\r\n     */\r\n    setMute: function (value)\r\n    {\r\n        this.mute = value;\r\n\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * @name Phaser.Sound.WebAudioSoundManager#mute\r\n     * @type {boolean}\r\n     * @fires Phaser.Sound.Events#GLOBAL_MUTE\r\n     * @since 3.0.0\r\n     */\r\n    mute: {\r\n\r\n        get: function ()\r\n        {\r\n            return (this.masterMuteNode.gain.value === 0);\r\n        },\r\n\r\n        set: function (value)\r\n        {\r\n            this.masterMuteNode.gain.setValueAtTime(value ? 0 : 1, 0);\r\n\r\n            this.emit(Events.GLOBAL_MUTE, this, value);\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * Sets the volume of this Sound Manager.\r\n     *\r\n     * @method Phaser.Sound.WebAudioSoundManager#setVolume\r\n     * @fires Phaser.Sound.Events#GLOBAL_VOLUME\r\n     * @since 3.3.0\r\n     *\r\n     * @param {number} value - The global volume of this Sound Manager.\r\n     *\r\n     * @return {Phaser.Sound.WebAudioSoundManager} This Sound Manager.\r\n     */\r\n    setVolume: function (value)\r\n    {\r\n        this.volume = value;\r\n\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * @name Phaser.Sound.WebAudioSoundManager#volume\r\n     * @type {number}\r\n     * @fires Phaser.Sound.Events#GLOBAL_VOLUME\r\n     * @since 3.0.0\r\n     */\r\n    volume: {\r\n\r\n        get: function ()\r\n        {\r\n            return this.masterVolumeNode.gain.value;\r\n        },\r\n\r\n        set: function (value)\r\n        {\r\n            this.masterVolumeNode.gain.setValueAtTime(value, 0);\r\n\r\n            this.emit(Events.GLOBAL_VOLUME, this, value);\r\n        }\r\n\r\n    }\r\n\r\n});\r\n\r\nmodule.exports = WebAudioSoundManager;\r\n"},"sourceMaps":null,"error":null,"hash":"5bd7c6ad0a1837bb404da8adba6a42a0","cacheData":{"env":{}}}